<div class="content">
  <div class="container">
    <!--Começo container-->
    <div class="modal-content-full">
      <div class="row">
        <div class="col-12">
            <h4><span translate>Coletas</span>&nbsp;&nbsp;<i class="fa fa-list-alt"></i></h4>
            <!-- caminho de telas percorrido -->
            <nav>
              <u><a style="color: #337ab7" class="pointer" href="#" routerLink="/" translate>Home</a></u><span> / </span>
              <span translate>Coletas</span>
            </nav>
            <br>
          <div class="card-box">            
            <!-- buscador -->
            <div class="row">
              <div class="col-sm-3">
                <a translate>Projetos</a><i *ngIf="carregandoProjetos" class="fa fa-spinner fa-spin fa-1x fa-fw text-autodocs"></i>
                <ng-select [items]="projects" [multiple]="true" bindLabel="descricao" groupBy="gender"
                  [selectableGroup]="true" [closeOnSelect]="true" bindValue="id" [(ngModel)]="selectedProject" (change)="CarregarQuestionarioEquipe()">
                  <ng-template ng-optgroup-tmp let-item="item" let-item$="item$" let-index="item.id">
                    <input id="item-{{index}}" type="checkbox" [ngModel]="item$.selected" />{{item.id}}
                  </ng-template>
                  <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                    <input id="item-{{index}}" type="checkbox" [ngModel]="item$.selected" />{{item.descricao}}
                  </ng-template>
                </ng-select>
              </div>
              <br>

              <div class="col-sm-3">
                <a translate>Questionário</a><i *ngIf="carregandoQuestionario" class="fa fa-spinner fa-spin fa-1x fa-fw text-autodocs"></i>
                <ng-select [items]="questions" [multiple]="true" bindLabel="descricao" groupBy="gender"
                  [selectableGroup]="true" [closeOnSelect]="false" bindValue="id" [(ngModel)]="selectedQuestions">
                  <ng-template ng-optgroup-tmp let-item="item" let-item$="item$" let-index="item.id">
                    <input id="item-{{index}}" type="checkbox" [ngModel]="item$.selected" /> {{item.id}}
                  </ng-template>
                  <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                    <input id="item-{{index}}" type="checkbox" [ngModel]="item$.selected" /> {{item.descricao}}
                  </ng-template>
                </ng-select>
              </div>
              <br>

              <div class="col-sm-3">
                <a translate>Equipes</a><i *ngIf="carregandoEquipes" class="fa fa-spinner fa-spin fa-1x fa-fw text-autodocs"></i>
                <ng-select [items]="equipe" [multiple]="true" bindLabel="Nome" groupBy="gender" [selectableGroup]="true"
                  [closeOnSelect]="false" bindValue="Id" [(ngModel)]="selectedEquipe" (change)="CarregarUsuarios()">
                  <ng-template ng-optgroup-tmp let-item="item" let-item$="item$" let-index="item.id">
                    <input id="item-{{index}}" type="checkbox" [ngModel]="item$.selected" /> {{item.id}}
                  </ng-template>
                  <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                    <input id="item-{{index}}" type="checkbox" [ngModel]="item$.selected" /> {{item.Nome}}
                  </ng-template>
                </ng-select>
              </div>
              <br>

              <div class="col-sm-3">
                <a translate>Usuários</a><i *ngIf="carregandoUsuarios" class="fa fa-spinner fa-spin fa-1x fa-fw text-autodocs"></i>
                <ng-select *ngIf="grid.itens.length == 0" [items]="usuario" [multiple]="true" bindLabel="nome" groupBy="gender"
                  [selectableGroup]="true" [closeOnSelect]="false" bindValue="id" [(ngModel)]="selectedUsuario">
                  <ng-template ng-optgroup-tmp let-item="item" let-item$="item$" let-index="item.id">
                    <input id="item-{{index}}" type="checkbox" [ngModel]="item$.selected" /> {{item.Id}}
                  </ng-template>
                  <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                    <input id="item-{{index}}" type="checkbox" [ngModel]="item$.selected" /> {{item.nome}}
                  </ng-template>
                </ng-select>

                <ng-select *ngIf="grid.itens.length > 0" [items]="grid.itens" [multiple]="true" bindLabel="nome"
                  groupBy="gender" [selectableGroup]="true" [closeOnSelect]="false" bindValue="id" [(ngModel)]="selectedUsuario">
                  <ng-template ng-optgroup-tmp let-item="item" let-item$="item$" let-index="item.id">
                    <input id="item-{{index}}" type="checkbox" [ngModel]="item$.selected" /> {{item.id}}
                  </ng-template>
                  <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                    <input id="item-{{index}}" type="checkbox" [ngModel]="item$.selected" /> {{item.nome}}
                  </ng-template>
                </ng-select>
              </div>

              <div class="col-sm-3">
                  <a  translate>ID</a><br>
                  <input class="from-control col-sm-12 inputExtra col-sm-1" type="text" [(ngModel)]="coletaID">
                </div>

              <div class="col-sm-3">
                <a translate>Intervalo de Data</a>
                <br>
                <div class="col-sm-6 inlineTime">
                    <ejs-datepicker  [(value)]='dataInicial' [max]='dataMaxima' [locale]="lang"></ejs-datepicker>
                </div>
                <div class="col-sm-6 inlineTime">
                    <ejs-datepicker class="col-sm-6" [(value)]='dataFinal' [min]='dataInicial' [max]='dataMaxima' [locale]="lang"></ejs-datepicker>
                </div>
                
              </div>

              <div class="col-sm-3">
                <a translate>Intervalo</a>
                <br>
                <div class="col-sm-6 inlineTime">
                  <ejs-timepicker [(ngModel)]="tempo" placeholder="00:00" [min]='horaInicial' [max]='tempo2' [format]='formatString' [step]='interval' [required]="true"></ejs-timepicker>
                </div>
                <div class="col-sm-6 inlineTime">
                  <ejs-timepicker [(ngModel)]="tempo2" placeholder="23:59" [min]='tempo' [max]='horaMaxima' [format]='formatString' [step]='interval' [required]="true"></ejs-timepicker>
                </div>
              </div>

              <div class="col-sm-3">
                <a translate>Status:</a>
                <select class="form-control" [(ngModel)]="Ativo">
                  <option [value]="null" translate>Todos</option>
                  <option [value]="true" translate>Ativo</option>
                  <option [value]="false" translate>Inativo</option>
                </select>
              </div>
            </div>
            <br>

            <div class="col-sm-12" *ngIf="selectedMarkers.length">
              <a translate>Endereços filtrados</a>
              <div class="row">
                <div class="input-group input-group-sm mb-3 col-sm-3" *ngFor="let marker of selectedMarkers">
                  <button type="button" class="btn btn-light bordaRedonda" (click)="tiraMarker(marker)">
                    <a>{{marker.address | slice:0:35 }}{{marker.address.length >= 35? '...':''}} {{marker.radius/1000}}
                      Km
                      <span class="badge badge-danger">x</span>
                    </a>
                  </button>
                </div>
              </div>
            </div>
            <br>

            <div class="col-sm-12" *ngIf="colecaoBuscaPesquisaPerguntas.length">
              <a translate>Filtros de perguntas</a>
              <div class="row">
                <div class="input-group input-group-sm mb-3 col-sm-3" *ngFor="let pesquisaPergunta of colecaoBuscaPesquisaPerguntas">
                  <button type="button" class="btn btn-light bordaRedonda">
                    <a a class="pointer" (click)="abrirModalBuscaPergunta(pesquisaPergunta)">{{pesquisaPergunta.NomeBuscaPesquisa
                      | slice:0:70 }}</a>
                    <span class="badge badge-danger setaDireita"><a class="pointer" (click)="deletarFiltroPergunta(pesquisaPergunta)">x</a></span>
                  </button>
                </div>
              </div>
            </div>
            <br>
            <!-- linha com os botões -->
            <div class="row">
              <div class="col" style="text-align: left">
                <div class="btn-group mr-2 mb-2" role="group">
                  <button class="botaoModal" type="button" class="btn botaoComum" data-toggle="modal" data-target="#modalAddress" [disabled]="buscando || gridSearchColeta.loading">
                    <span translate>Filtrar por Geolocalização</span>&nbsp;&nbsp;
                    <i class="fa fa-filter"></i>
                  </button>
                </div>
                <a *ngIf="mostraBuscaSalva" class="btn botaoComum mr-2 mb-2" style="color: white;" data-toggle="collapse" href="#collapseBuscaSalvas" role="button" aria-expanded="false" aria-controls="collapseBuscaSalvas">
                  <span translate>Ver buscas salvas</span>&nbsp;&nbsp;
                  <i *ngIf="!carregandoBuscaSalvas" class="fa fa-eye"></i>
                  <i *ngIf="carregandoBuscaSalvas" class="fa fa-spinner fa-spin fa-1x fa-fw text-autodocs"></i>
                </a>

                <div class="btn-group mr-2 mb-2" role="group">
                  <button class="botaoModal" type="button" class="btn botaoComum" (click)='setarQuestionarios()' [disabled]="buscando || gridSearchColeta.loading">
                    <span translate>Buscas Avançadas Perguntas</span>&nbsp;&nbsp;
                    <i class="fa fa-search"></i>
                  </button>
                </div>
              </div>
              <div class="col-6 align-middle" style="text-align: right;">
                <div class="btn-group mr-2 mb-2" role="group">
                  <button type="button" class="btn botaoComum" (click)="buscar()" [disabled]="buscando || gridSearchColeta.loading">
                    <span translate>Buscar</span>&nbsp;&nbsp;
                    <i class="fa fa-search"></i>
                  </button>
                </div>
                <div class="btn-group mr-2 mb-2" role="group">
                  <button type="button" class="btn botaoComum" (click)="setarLocalizacaoToggle()" data-toggle="modal" [disabled]="!pesquisado || buscando || gridSearchColeta.loading">
                    <span translate>Ver no mapa</span>&nbsp;&nbsp;
                    <i *ngIf="!carregandoToggle" class="fa fa-map"></i>
                    <i *ngIf="carregandoToggle" class="fa fa-spinner fa-spin fa-1x fa-fw text-autodocs"></i>
                  </button>
                </div>
                <div class="btn-group mr-2 mb-2" role="group"> 
                  <button type="button" class="btn botaoComum" (click)="buscarExcel()" [disabled]="!pesquisado || buscando || gridSearchColeta.loading">
                    <span translate>Excel</span>&nbsp;&nbsp;
                    <i *ngIf="!carregandoExcel" class="fa fa-file-excel-o"></i>
                    <i *ngIf="carregandoExcel" class="fa fa-spinner fa-spin fa-1x fa-fw text-autodocs"></i>
                  </button>
                </div>
                <div class="btn-group mr-2 mb-2" role="group">
                  <button type="button" class="btn botaoCancelar" (click)="limparFiltros()">
                    <span translate>Limpar Filtros</span>&nbsp;&nbsp;
                    <i class="fa fa-trash"></i>
                  </button>
                </div>
                <div class="btn-group mr-2 mb-2" role="group">
                  <button type="button" class="btn botaoSalvar" data-toggle="modal" data-target="#modalSaveSearch" [disabled]="buscando || gridSearchColeta.loading">
                    <span translate>Salvar pesquisa</span>&nbsp;&nbsp;
                    <i *ngIf="!salvarBusca" class="fa fa-save"></i>
                    <i *ngIf="salvarBusca" class="fa fa-spinner fa-spin fa-1x fa-fw text-autodocs"></i>
                  </button>
                </div>
              </div>
            </div>
            <!-- fim da linha com os botões -->
            <br>
            <div class="collapse" id="collapseBuscaSalvas">
              <div class="card card-body">
                <div class="table-loading text-center" *ngIf="excluindoBusca">
                  <i class="fa fa-spinner fa-spin fa-2x fa-fw text-autodocs"></i>
                </div>
                <div class="row">
                  <div class="input-group input-group-sm mt-3 mb-3 col-sm-3" *ngFor="let retorno of buscaRetorno.buscaSalva">
                    <button type="button" id="inputGroup-sizing-sm" aria-label="Small" class="btn btn-light bordaRedonda" [disabled]="buscando || gridSearchColeta.loading">
                      <span><a class="pointer" (click)="setarBusca(retorno)">{{retorno.nomeBusca}}</a></span>
                      <span class="badge badge-danger setaDireita"><a class="pointer" (click)="deletarBuscaSalva(retorno)">x</a></span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <!--Fim Buscador-->
            <div class="row">
              <div class="col-md-12">
                <div class="card-box" style="height: 58rem;">
                  <div class="table-rep-plugin">

                    <!-- começo da area de paginação -->
                      <nav *ngIf="gridSearchColeta.totalPages > 1" style="margin-top: 20px;">
                          <ul class="pager">
                            <li class="pointer">
                              <a [class.disabled]="!gridSearchColeta.hasPreviousPage()" (click)="gridSearchColeta.goToFirstPage()">
                                <i class="fa fa-angle-double-left"></i>
                              </a>
                            </li>
                            <li class="pointer">
                              <a [class.disabled]="!gridSearchColeta.hasPreviousPage()" (click)="gridSearchColeta.goToPreviousPage()">
                                <i class="fa fa-angle-left"></i>
                              </a>
                            </li>
                            <li>
                              <span class="mb-2" translate>Página</span>
                              <a class="mb-2">
                                {{ gridSearchColeta.pageIndex }}
                              </a>
                              <span class="mb-2" translate>de</span>
                              <a class="mb-2">
                                {{ gridSearchColeta.totalPages }}
                              </a>
                            </li>
                            <li class="pointer">
                              <a [class.disabled]="!gridSearchColeta.hasNextPage()" (click)="gridSearchColeta.goToNextPage()">
                                <i class="fa fa-angle-right"></i>
                              </a>
                            </li>
                            <li class="pointer mr-5 mb-2">
                              <a [class.disabled]="!gridSearchColeta.hasNextPage()" (click)="gridSearchColeta.goToLastPage()">
                                <i class="fa fa-angle-double-right"></i>
                              </a>
                            </li>
                            <li class="col-4" style="text-align: Center;">
                                <span translate>Coletas por página: </span>
                                <select [(ngModel)]="pageSize" (change)="setPage()" class="mb-2 mr-2">
                                  <option [value]="20" translate>20</option>
                                  <option [value]="50" translate>50</option>
                                  <option [value]="100" translate>100</option>
                                  <option [value]="200" translate>200</option>
                                </select>
                              </li>                    
                          <li class="col-4" style="float: right;">
                              <span translate>Total de Coletas </span>
                              {{gridSearchColeta.totalRows}}
                          </li>
                              
                        </ul>
                      </nav>
                      <!-- fim do elemento de paginação no começo da tela -->

                    <div class="table-responsive" style="height: 48rem;">
                      <div class="table-loading text-center" *ngIf="gridSearchColeta.loading && !gridSearchColeta.error">
                        <i class="fa fa-spinner fa-spin fa-5x fa-fw text-autodocs"></i>
                      </div>
                      <div class="table-loading text-center" *ngIf="grid.loading && !grid.error">
                        <i class="fa fa-spinner fa-spin fa-5x fa-fw text-autodocs"></i>
                      </div>

                      <table class="table table-striped table-reponsive">
                        <thead>
                          <tr>
                            <th data-priority="1" translate>ID</th>
                            <th data-priority="1" translate>Data</th>
                            <th data-priority="1" translate>Hora Local</th>
                            <th data-priority="1" translate>Duração</th>
                            <th data-priority="1" translate>Usuário</th>
                            <th data-priority="1" translate>Equipe</th>
                            <th data-priority="1" translate>Questionário</th>
                            <th data-priority="1" translate>Projeto</th>
                            <th data-priority="1" translate>Ativo</th>
                            <th data-priority="1" translate>Nota</th>
                            <th data-priority="2"></th>
                          </tr>
                        </thead>
                        <tbody class="tamanhoFontGridColeta">
                          <tr *ngFor="let coleta of gridSearchColeta.itens">
                            <td>{{coleta.idColeta}}</td>
                            <td>{{coleta.dtInicio | slice:0:10 | date: dateFormat}} {{coleta.dtInicio | slice:11:16}}</td>
                            <td>{{coleta.dtInicio | date: 'HH:mm'}}</td>
                            <td>{{coleta.duracao | slice:0:5}}</td>
                            <td>{{coleta.nomeUsuario}}</td>
                            <td>{{coleta.nomeEquipe}}</td>
                            <td>{{coleta.descQuestionario}}</td>
                            <td>{{coleta.descProjeto}}</td>
                            <td *ngIf="coleta.ativo == true"><i class="fa fa-check checkverde"></i></td>
                            <td *ngIf="coleta.ativo == false"><i class="fa fa-check checkCinza"></i></td>
                            <td>
                                <div *ngIf="coleta.nota" class="estrelas">
                                    <i *ngFor="let star of rates" class="fa"
                                      [class.fa-star]="star <= coleta.nota"
                                    [class.fa-star-o]="star > coleta.nota"></i>
                                </div>
                            </td>
                            <td>
                              <div class="btn-group">
                                <button type="button" class="btn btn-secondary waves-effect" data-toggle="dropdown" aria-expanded="false" aria-dropeffect="popup">
                                  <i class="dripicons-menu"></i>
                                </button>
                                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu">
                                  <button class="dropdown-item" type="button" (click)='setarPerguntasColetas(coleta.descProjeto, coleta.idUsuario, coleta.idQuestionario, coleta.idColeta, coleta.nomeUsuario, coleta.dtInicio, coleta.dtTermino, coleta.duracao)'><i class="fa fa-file-text"></i>&nbsp;&nbsp;<span translate>Respostas</span></button>
                                  <button *ngIf="coleta.latitude || coleta.longitude" class="dropdown-item" type="button" (click)="mostraMapa(coleta.latitude, coleta.longitude)" data-toggle="modal" data-target="#modalGeo"><i class="fa fa-map-marker"></i>&nbsp;&nbsp;<span translate>Geolocalização</span></button>
                                  <button *ngIf="(coleta.latitude == null && coleta.longitude == null)||(coleta.latitude == 0 && coleta.longitude == 0)" type="button" class="dropdown-item" disabled><i class="fa fa-map-marker"></i>&nbsp;&nbsp;<span translate>Geolocalização</span></button>
                                  <button *ngIf="!coleta.nota" class="dropdown-item" type="button" data-toggle="modal" data-target="#modalAvaliar"  (click)='avaliar(coleta.idColeta)'><i class="fa fa-thumbs-o-up"></i>&nbsp;&nbsp;<span translate>Avaliar</span></button>
                                  <button *ngIf="coleta.nota" class="dropdown-item" type="button" (click)='EditarAvaliacao(coleta.idColeta)'><i class="fa fa-thumbs-o-up"></i>&nbsp;&nbsp;<span translate>Editar Avaliação</span></button>
                                </div>
                                </div>
                            </td>
                          </tr>
                          <tr *ngIf="pesquisado && !gridSearchColeta.loading && gridSearchColeta.itens.length == 0">
                              <td class="text-center" colspan="10" translate>Não foi encontrado registros</td>
                            </tr>
                        </tbody>
                      </table>
                    </div>

                    <!-- Paginação depois da tabela -->
                    <nav *ngIf="gridSearchColeta.totalPages > 1" style="margin-top: 20px;">
                        <ul class="pager">
                          <li class="pointer">
                            <a [class.disabled]="!gridSearchColeta.hasPreviousPage()" (click)="gridSearchColeta.goToFirstPage()">
                              <i class="fa fa-angle-double-left"></i>
                            </a>
                          </li>
                          <li class="pointer">
                            <a [class.disabled]="!gridSearchColeta.hasPreviousPage()" (click)="gridSearchColeta.goToPreviousPage()">
                              <i class="fa fa-angle-left"></i>
                            </a>
                          </li>
                          <li>
                            <span class="mb-2" translate>Página</span>
                            <a class="mb-2">
                              {{ gridSearchColeta.pageIndex }}
                            </a>
                            <span class="mb-2" translate>de</span>
                            <a class="mb-2">
                              {{ gridSearchColeta.totalPages }}
                            </a>
                          </li>
                          <li class="pointer">
                            <a [class.disabled]="!gridSearchColeta.hasNextPage()" (click)="gridSearchColeta.goToNextPage()">
                              <i class="fa fa-angle-right"></i>
                            </a>
                          </li>
                          <li class="pointer mr-5 mb-2">
                            <a [class.disabled]="!gridSearchColeta.hasNextPage()" (click)="gridSearchColeta.goToLastPage()">
                              <i class="fa fa-angle-double-right"></i>
                            </a>
                          </li>
                          <li class="col-4" style="text-align: Center;">
                              <span translate>Coletas por página: </span>
                              <select [(ngModel)]="pageSize" (change)="setPage()" class="mb-2 mr-2">
                                <option [value]="20" translate>20</option>
                                <option [value]="50" translate>50</option>
                                <option [value]="100" translate>100</option>
                                <option [value]="200" translate>200</option>
                              </select>
                            </li>                    
                        <li class="col-4" style="float: right;">
                            <span translate>Total de Coletas </span>
                            {{gridSearchColeta.totalRows}}
                        </li>
                            
                      </ul>
                    </nav>
                    <!-- Fim da paginação no fim da tabela -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- modal de adicionar endereço -->
      <div class="modal fade" id="modalAddress" tabindex="-1" role="dialog" aria-labelledby="modalAddress" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="ModalLabel" translate>Pesquisa por Endereço</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <a translate>Endereços</a>
              <div class="form-group">
                <input autocorrect="off" autocapitalize="off" spellcheck="off" type="text" class="form-control" #search
                  [(formControl)]="searchControl">
              </div>

              <div class="form-group">
                <a translate>Km</a>
                <select class="form-control" [(ngModel)]="km" (change)="radiusChange()">
                  <option [value]=5>5</option>
                  <option [value]=10>10</option>
                  <option [value]=15>15</option>
                  <option [value]=20>20</option>
                </select>
              </div>

              <div *ngFor="let marker of selectedMarkers">
                <button type="button" class="btn btn-light mb-3 bordaRedonda" (click)="tiraMarker(marker)">
                  <a>{{marker.address | slice:0:36 }}{{marker.address.length >= 36? '...':''}} {{marker.radius/1000}}
                    Km
                    <span class="badge badge-danger">x</span>
                  </a>
                </button>
              </div>
              <br>

              <agm-map class="tamanho" [latitude]="latitude" [longitude]="longitude" [zoom]="zoom" [disableDefaultUI]="false"
                [zoomControl]="false">
                <agm-marker *ngFor="let m of markers; let i = index" [latitude]="m.lat" [longitude]="m.lng" [label]="m.label"
                  [visible]="true">
                  <agm-circle [latitude]="m.lat" [longitude]="m.lng" [radius]="m.radius" [fillColor]="'blue'"
                    [circleDraggable]="false" [editable]="false"></agm-circle>
                </agm-marker>
              </agm-map>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn botaoCancelar" data-dismiss="modal"><span translate>Cancelar</span>&nbsp;&nbsp;<i class="fa fa-ban banIcon"></i></button>
              <button type="button" class="btn botaoSalvar" (click)="salvarLocatizacao()"><span translate>Salvar</span>&nbsp;&nbsp;<i class="fa fa-save"></i></button>
            </div>
          </div>
        </div>
      </div>

      <!-- modal de mapa pinado com a coleta selecionada -->
      <div class="modal fade" id="modalGeo" tabindex="-1" role="dialog" aria-labelledby="modalGeo" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-body">
              <agm-map class="tamanho" [latitude]="lat" [longitude]="lng" [zoom]="zoom" [disableDefaultUI]="false"
                [zoomControl]="false">
                <agm-marker [latitude]="lat" [longitude]="lng" [visible]="true">
                </agm-marker>
              </agm-map>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn botaoCancelar" data-dismiss="modal"><span translate>Fechar</span>&nbsp;&nbsp;<i class="fa fa-remove banIcon"></i></button>
            </div>
          </div>
        </div>
      </div>

      <!-- modal de mapa pinado com todas as coletas -->
      <div class="modal fade" id="modalToggle" tabindex="-1" role="dialog" aria-labelledby="modalToggle" aria-hidden="true">
        <div class="modal-dialog modal-full" role="document">
          <div class="modal-content modal-content-full">
            <div class="modal-body p-4">
              <agm-map class="tamanho2" [latitude]="lat" [longitude]="lng" [zoom]="zoom" [disableDefaultUI]="false"
                [zoomControl]="false" #mapa>
                <agm-marker *ngFor="let m of toggleMarkers; let i = index" [latitude]="m.lat" [longitude]="m.lng"
                  [visible]="true">
                  <agm-info-window>
                    <p>
                      <strong>ID:</strong>{{m.label}}</p>
                    <p>
                      <strong>Nome:</strong>{{m.name}}</p>
                    <p>
                      <strong>Data:</strong>{{m.Data | date: dateFormat}}</p>
                  </agm-info-window>
                </agm-marker>
              </agm-map>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn botaoCancelar" data-dismiss="modal"><span translate>Fechar</span>&nbsp;&nbsp;<i class="fa fa-remove banIcon"></i></button>
            </div>
          </div>
        </div>
      </div>

      <!-- modal de injetar as perguntas -->
      <div class="modal" id="modalPerguntas" tabindex="-1" role="dialog" aria-labelledby="modalPerguntas" aria-hidden="true">
        <div class="modal-dialog modal15por" role="document">
          <div class="modal-content">
            <div id="pdfModal" class="modal-body">
              <div>
                    <h5><span translate>Usuário</span>: {{nomeUsuario}}</h5>
                    <h5><span translate>Data Inicial</span>: {{dataInicio | date: dateFormat}}&nbsp;{{dataInicio | slice:11:16}}</h5> 
                    <h5><span translate>Data Final</span>: {{dataFim | date: dateFormat}}&nbsp;{{dataFim | slice:11:16}}</h5> 
                    <h5><span translate>Duração</span>: {{duracao | slice:0:5}}</h5>
                <br>
                <app-audios *ngIf="audioUrl && audioUrl != 'não tem audio'" [audioUrl]="audioUrl" [multimidia]="null" ></app-audios>
              <a *ngFor="let secao of perguntas">
                <h5>{{secao.nome}}</h5>
                <h4 *ngIf="secao.idTipoSecao == 2"><span class="tamanhoFonteRespostasColetas" [innerHTML]="secao.conteudoInformativo"></span></h4>
                <h5 *ngIf="secao.idTipoSecao != 2">{{secao.conteudoInformativo}}</h5>
                <h4 *ngIf="secao.conteudoInformativo"></h4>
                <div *ngFor="let pergunta of secao.perguntas">
                  <div *ngIf="pergunta.idTipoPergunta == 1">
                    <app-selecao-lista-externa [perguntas]="pergunta" [type]="'Externa'" [dadosSelecao]="[]" [disable]="true" [multimidia]="coletaMultimidia"></app-selecao-lista-externa>
                  </div>
                  <div *ngIf="pergunta.idTipoPergunta == 2" class="control-section">
                    <app-resposta-livre [coletas]="respostaAlternativa" [perguntas]="pergunta" [dadosSelecao]="pergunta.perguntaAlternativas" [disable]="true" [multimidia]="coletaMultimidia"></app-resposta-livre>
                  </div>
                  <div *ngIf="pergunta.idTipoPergunta == 3" class="control-section">
                    <app-checkbox [coletas]="respostaAlternativa" [perguntas]="pergunta" [dadosSelecao]="pergunta.perguntaAlternativas" [type]="type" [multimidia]="coletaMultimidia"></app-checkbox>
                  </div>
                  <div *ngIf="pergunta.idTipoPergunta == 4" class="control-section">
                    <app-checkbox-sim-nao [coletas]="respostaAlternativa" [perguntas]="pergunta" [dadosSelecao]="pergunta.perguntaAlternativas" [type]="type" [disable]="true" [multimidia]="coletaMultimidia"></app-checkbox-sim-nao>
                  </div>
                  <div *ngIf="pergunta.idTipoPergunta == 5" class="control-section">
                    <app-respota-livre-data [coletas]="respostaAlternativa" [perguntas]="pergunta" [type]="type" [disable]="true" [multimidia]="coletaMultimidia"></app-respota-livre-data>
                  </div>
                  <div *ngIf="pergunta.idTipoPergunta == 6" class="control-section">
                    <app-respota-livre-numerica [coletas]="respostaAlternativa" [perguntas]="pergunta" [type]="type" [disable]="true" [multimidia]="coletaMultimidia"></app-respota-livre-numerica>
                  </div>
                  <div *ngIf="pergunta.idTipoPergunta == 7" class="control-section">
                    <app-selecao-lista-externa [coletas]="respostaAlternativa" [perguntas]="pergunta" [type]="'Interna'" [dadosSelecao]="pergunta.perguntaAlternativas" [multimidia]="coletaMultimidia"></app-selecao-lista-externa>
                  </div>
                  <div *ngIf="pergunta.idTipoPergunta == 8" class="control-section">
                    <app-multi-selecao-checkbox-dimensao [coletas]="respostaAlternativa" [perguntas]="pergunta" [type]="null" [dadosSelecao]="pergunta.perguntaAlternativas" [multimidia]="coletaMultimidia"></app-multi-selecao-checkbox-dimensao>
                  </div>
                  <div *ngIf="pergunta.idTipoPergunta == 9" class="radiobutton-control">
                    <app-radio-button [coletas]="respostaAlternativa" [perguntas]="pergunta" [dadosSelecao]="pergunta.perguntaAlternativas" [type]="type" [multimidia]="coletaMultimidia"></app-radio-button>
                  </div>
                  <div *ngIf="pergunta.idTipoPergunta == 10">
                    <app-rating [coletas]="respostaAlternativa" [perguntas]="pergunta" [length]="10" [multimidia]="coletaMultimidia"></app-rating>
                  </div>
                  <div *ngIf="pergunta.idTipoPergunta == 11">
                    <app-codigo-barras [coletas]="respostaAlternativa" [perguntas]="pergunta" [dadosSelecao]="pergunta.perguntaAlternativas" [disable]="true" [multimidia]="coletaMultimidia"></app-codigo-barras>
                  </div>
                  <div *ngIf="pergunta.idTipoPergunta == 12">
                    <app-pergunta-entidade [coletas]="respostaAlternativa" [perguntas]="pergunta" [dadosSelecao]="pergunta.perguntaAlternativas" [disable]="true" [multimidia]="coletaMultimidia"></app-pergunta-entidade>
                  </div>
                  <div *ngIf="pergunta.idTipoPergunta == 13">
                    <app-pergunta-informativa [secao]="perguntas" [coletas]="respostaAlternativa" [perguntas]="pergunta" [dadosSelecao]="pergunta.perguntaAlternativas" [disable]="true" [multimidia]="coletaMultimidia"></app-pergunta-informativa>
                  </div>
                </div>
              </a>
            </div>
          </div>
            <div class="modal-footer">
              <button type="button" class="btn botaoComum" (click)="imprimindo()" >
                <span translate>PDF</span>&nbsp;&nbsp;
                <i *ngIf="!gerandoPDF" class="fa fa-file-pdf-o"></i>
                <i *ngIf="gerandoPDF" class="fa fa-spinner fa-spin fa-1x fa-fw text-autodocs"></i>
              </button>
              <button type="button" class="btn botaoCancelar" data-dismiss="modal">
                <span translate>Fechar</span>&nbsp;&nbsp;
                <i class="fa fa-remove banIcon"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      

      <!-- modal para incluir o nome da pesquisa feita e salvar -->
      <div class="modal fade" id="modalSaveSearch" tabindex="-1" role="dialog" aria-labelledby="modalSaveSearch"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
                <div class="text-center">
                    <span *ngIf="!nomeBusca" translate>Salvar pesquisa</span>
                    <span *ngIf="nomeBusca && nomeBusca != nomeBuscaAnterior" translate>Salvar pesquisa</span>
                    <span *ngIf="nomeBusca && nomeBusca == nomeBuscaAnterior" translate>Atualizar Pesquisa guardada</span>
                </div>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">     
              <span translate>Digite um nome para essa pesquisa</span>
              <input type="text" class="form-control" id="nome" name="nomeBusca" [(ngModel)]="nomeBusca">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn botaoCancelar" data-dismiss="modal"><span translate>Fechar</span>&nbsp;&nbsp;<i class="fa fa-remove banIcon"></i></button>
              <button *ngIf="!nomeBusca" type="button" class="btn botaoSalvar" (click)="salvarPesquisa()" data-dismiss="modal"><span translate>Salvar</span>&nbsp;&nbsp;<i class="fa fa-save"></i></button>
              <button *ngIf="nomeBusca && nomeBusca != nomeBuscaAnterior" type="button" class="btn botaoSalvar" (click)="salvarPesquisa()"
                data-dismiss="modal"><span translate>Salvar</span>&nbsp;&nbsp;<i class="fa fa-save"></i></button>
              <button *ngIf="nomeBusca && nomeBusca == nomeBuscaAnterior" type="button" class="btn botaoSalvar" (click)="atualizarSalvarPesquisa()"
                data-dismiss="modal"><span translate>Atualizar</span>&nbsp;&nbsp;<i class="fa fa-save"></i></button>
            </div>
          </div>
        </div>
      </div>

      <!-- modal de adicionar Busca avançada de perguntas -->
      <div class="modal" id="modalPerguntasBusca" tabindex="-1" role="dialog" aria-labelledby="modalPerguntasBusca"
        aria-hidden="true">
        <div class="modal-dialog modal15por" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="ModalLabel" translate>Pesquisa Avançada de Perguntas</h5>
            </div>
            <app-questions [isNew]="isNew" [resposta]="resposta" [QuestionarioParaSelecionar]="QuestionarioParaSelecionar"
              [nomeBuscaPergunta]="nomeBuscaPergunta" [idQuestionarioSelecionado]="idQuestionarioSelecionado"
              [perguntasParaSelecionar]="perguntasParaSelecionar" [perguntasParaSelecionar2]="perguntasParaSelecionar2"
              [questionarioSelecionado]="questionarioSelecionado" [buscaAvancadaPergunta]="buscaAvancadaPergunta"
              [desabilitarQuestionario]="desabilitarQuestionario" (retorno)="receiverFeedback($event)"
              (retornoIdQuestionarioSelecionado)="receiverIdQuestionario($event)" [buscaAvancadaPerguntaFront]="buscaAvancadaPerguntaFront"></app-questions>
          </div>
        </div>
      </div>
    </div>

    <!-- modal para incluir o nome da pesquisa de pergunta feita e salvar -->
    <div class="modal fade" id="modalSaveSearchQuestion" tabindex="-1" role="dialog" aria-labelledby="modalSaveSearchQuestion"
      aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <span translate>Digite um nome para essa pesquisa</span>
            <input type="text" class="form-control" id="nome" name="nomeBusca" [(ngModel)]="nomeBuscaPergunta">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn botaoCancelar" data-dismiss="modal"><span translate>Fechar</span>&nbsp;&nbsp;<i class="fa fa-remove banIcon"></i></button>
            <button  type="button" class="btn botaoSalvar" data-dismiss="modal" (click)="salvarGrupoBuscaAvancadaPergunta()"><span translate>Salvar</span>&nbsp;&nbsp;<i class="fa fa-save"></i></button>
          </div>
        </div>
      </div>
    </div>

    <!-- modal de avaliação de coleta -->
    <div class="modal fade" id="modalAvaliar" tabindex="-1" role="dialog" aria-labelledby="modalAvaliar" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
              <span translate>Avaliação da Coleta Realizada</span>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
          <div class="modal-body p-4">
            <span translate>Nota</span>
            <div class="col-12 estrelas">
              <i *ngFor="let star of rates" class="fa"
                 [class.fa-star]="star <= rate"
                 [class.fa-star-o]="star > rate"
                 (click)="setRate(star)"
                 (mouseenter)="setTemporaryRate(star)"
                 (mouseleave)="clearTemporaryRate()"></i>
              </div>
          </div>
          <div class="col-12">
            <span translate>Observação</span>
            <textarea class="form-control" [(ngModel)]="textArea"></textarea>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn botaoCancelar" data-dismiss="modal"><span translate>Fechar</span>&nbsp;&nbsp;<i class="fa fa-remove banIcon"></i></button>
            <button  type="button" class="btn botaoSalvar" data-dismiss="modal" (click)="salvarAvaliacao()"><span translate>Salvar</span>&nbsp;&nbsp;<i class="fa fa-save"></i></button>
          </div>
        </div>
      </div>
    </div>

    <!-- modal de editar avaliação de coleta -->
    <div class="modal fade" id="modalEditarAvaliar" tabindex="-1" role="dialog" aria-labelledby="modalEditarAvaliar" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
              <span translate>Avaliação da Coleta Realizada</span>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
          <div class="modal-body p-4">
            <span translate>Nota</span>
            <div class="col-12 estrelas">
              <i *ngFor="let star of rates" class="fa"
                 [class.fa-star]="star <= rate"
                 [class.fa-star-o]="star > rate"
                 (click)="setRate(star)"
                 (mouseenter)="setTemporaryRate(star)"
                 (mouseleave)="clearTemporaryRate()"></i>
              </div>
          </div>
          <div class="col-12">
            <span translate>Observação</span>
            <textarea class="form-control" [(ngModel)]="textArea"></textarea>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn botaoCancelar" data-dismiss="modal"><span translate>Fechar</span>&nbsp;&nbsp;<i class="fa fa-remove banIcon"></i></button>
            <button  type="button" class="btn botaoSalvar" data-dismiss="modal" (click)="salvarAvaliacaoAtualizada()"><span translate>Atualizar</span>&nbsp;&nbsp;<i class="fa fa-save"></i></button>
          </div>
        </div>
      </div>
    </div>

  </div>
  <!--Fim container-->
</div>

<!-- Componente que faz o spinner de tela inteira -->
<ngx-spinner bdColor="rgba(51, 51, 51, 0.8)" size="large" color="#fff" type="ball-triangle-path"></ngx-spinner>